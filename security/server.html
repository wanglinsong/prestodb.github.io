
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="374665">
  <script src="../_static/javascripts/modernizr.js"></script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-82811140-44"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'UA-82811140-44');
</script>
  
  
    <title>Coordinator Kerberos Authentication &#8212; Presto 0.280-SNAPSHOT Documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/presto.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="CLI Kerberos Authentication" href="cli.html" />
    <link rel="prev" title="Security" href="../security.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=grey data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#security/server" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="Presto 0.280-SNAPSHOT Documentation"
           class="md-header-nav__button md-logo">
          
              <img src="../_static/logo.png" height="26"
                   alt="Presto 0.280-SNAPSHOT Documentation logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Presto 0.280-SNAPSHOT Documentation</span>
          <span class="md-header-nav__topic"> Coordinator Kerberos Authentication </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/prestodb/presto" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Presto
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    <!-- empty -->
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Presto 0.280-SNAPSHOT Documentation" class="md-nav__button md-logo">
      
        <img src="../_static/logo.png" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="Presto 0.280-SNAPSHOT Documentation">Presto 0.280-SNAPSHOT Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/prestodb/presto" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Presto
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../overview.html" class="md-nav__link">Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installation.html" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../security.html" class="md-nav__link">Security</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Coordinator Kerberos Authentication </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Coordinator Kerberos Authentication</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#security-server--page-root" class="md-nav__link">Coordinator Kerberos Authentication</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#environment-configuration" class="md-nav__link">Environment Configuration</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#kerberos-services" class="md-nav__link">Kerberos Services</a>
        </li>
        <li class="md-nav__item"><a href="#mit-kerberos-configuration" class="md-nav__link">MIT Kerberos Configuration</a>
        </li>
        <li class="md-nav__item"><a href="#kerberos-principals-and-keytab-files" class="md-nav__link">Kerberos Principals and Keytab Files</a>
        </li>
        <li class="md-nav__item"><a href="#java-cryptography-extension-policy-files" class="md-nav__link">Java Cryptography Extension Policy Files</a>
        </li>
        <li class="md-nav__item"><a href="#java-keystore-file-for-tls" class="md-nav__link">Java Keystore File for TLS</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#system-access-control-plugin" class="md-nav__link">System Access Control Plugin</a>
        </li>
        <li class="md-nav__item"><a href="#presto-coordinator-node-configuration" class="md-nav__link">Presto Coordinator Node Configuration</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#config-properties" class="md-nav__link">config.properties</a>
        </li>
        <li class="md-nav__item"><a href="#access-controls-properties" class="md-nav__link">access-controls.properties</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#troubleshooting" class="md-nav__link">Troubleshooting</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#kerberos-verification" class="md-nav__link">Kerberos Verification</a>
        </li>
        <li class="md-nav__item"><a href="#java-keystore-file-verification" class="md-nav__link">Java Keystore File Verification</a>
        </li>
        <li class="md-nav__item"><a href="#additional-kerberos-debugging-information" class="md-nav__link">Additional Kerberos Debugging Information</a>
        </li>
        <li class="md-nav__item"><a href="#additional-resources" class="md-nav__link">Additional resources</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="cli.html" class="md-nav__link">CLI Kerberos Authentication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="ldap.html" class="md-nav__link">LDAP Authentication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="password-file.html" class="md-nav__link">Password File Authentication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tls.html" class="md-nav__link">Java Keystores and Truststores</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="built-in-system-access-control.html" class="md-nav__link">Built-in System Access Control</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="internal-communication.html" class="md-nav__link">Secure Internal Communication</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="authorization.html" class="md-nav__link">Authorization</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../admin.html" class="md-nav__link">Administration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../cache.html" class="md-nav__link">Cache</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../optimizer.html" class="md-nav__link">Query Optimizer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../connector.html" class="md-nav__link">Connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../functions.html" class="md-nav__link">Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../language.html" class="md-nav__link">SQL Language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../sql.html" class="md-nav__link">SQL Statement Syntax</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../migration.html" class="md-nav__link">Migration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../router.html" class="md-nav__link">Router</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../release.html" class="md-nav__link">Release Notes</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#security-server--page-root" class="md-nav__link">Coordinator Kerberos Authentication</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#environment-configuration" class="md-nav__link">Environment Configuration</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#kerberos-services" class="md-nav__link">Kerberos Services</a>
        </li>
        <li class="md-nav__item"><a href="#mit-kerberos-configuration" class="md-nav__link">MIT Kerberos Configuration</a>
        </li>
        <li class="md-nav__item"><a href="#kerberos-principals-and-keytab-files" class="md-nav__link">Kerberos Principals and Keytab Files</a>
        </li>
        <li class="md-nav__item"><a href="#java-cryptography-extension-policy-files" class="md-nav__link">Java Cryptography Extension Policy Files</a>
        </li>
        <li class="md-nav__item"><a href="#java-keystore-file-for-tls" class="md-nav__link">Java Keystore File for TLS</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#system-access-control-plugin" class="md-nav__link">System Access Control Plugin</a>
        </li>
        <li class="md-nav__item"><a href="#presto-coordinator-node-configuration" class="md-nav__link">Presto Coordinator Node Configuration</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#config-properties" class="md-nav__link">config.properties</a>
        </li>
        <li class="md-nav__item"><a href="#access-controls-properties" class="md-nav__link">access-controls.properties</a>
        </li></ul>
            </nav>
        </li>
        <li class="md-nav__item"><a href="#troubleshooting" class="md-nav__link">Troubleshooting</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#kerberos-verification" class="md-nav__link">Kerberos Verification</a>
        </li>
        <li class="md-nav__item"><a href="#java-keystore-file-verification" class="md-nav__link">Java Keystore File Verification</a>
        </li>
        <li class="md-nav__item"><a href="#additional-kerberos-debugging-information" class="md-nav__link">Additional Kerberos Debugging Information</a>
        </li>
        <li class="md-nav__item"><a href="#additional-resources" class="md-nav__link">Additional resources</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="coordinator-kerberos-authentication">
<h1 id="security-server--page-root">Coordinator Kerberos Authentication<a class="headerlink" href="#security-server--page-root" title="Permalink to this headline">#</a></h1>
<p>The Presto coordinator can be configured to enable Kerberos authentication over
HTTPS for clients, such as the <a class="reference internal" href="cli.html"><span class="doc">Presto CLI</span></a>, or the
JDBC and ODBC drivers.</p>
<p>To enable Kerberos authentication for Presto, configuration changes are made on
the Presto coordinator. No changes are required to the worker configuration;
the worker nodes will continue to connect to the coordinator over
unauthenticated HTTP. However, if you want to secure the communication between
Presto nodes with SSL/TLS, configure <a class="reference internal" href="internal-communication.html"><span class="doc">Secure Internal Communication</span></a>.</p>
<section id="environment-configuration">
<h2 id="environment-configuration">Environment Configuration<a class="headerlink" href="#environment-configuration" title="Permalink to this headline">#</a></h2>
<section id="kerberos-services">
<span id="server-kerberos-services"></span><h3 id="kerberos-services">Kerberos Services<a class="headerlink" href="#kerberos-services" title="Permalink to this headline">#</a></h3>
<p>You will need a Kerberos <abbr title="Key Distribution Center">KDC</abbr> running on a
node that the Presto coordinator can reach over the network. The KDC is
responsible for authenticating principals and issuing session keys that can be
used with Kerberos-enabled services. KDCs typically run on port 88, which is
the IANA-assigned port for Kerberos.</p>
</section>
<section id="mit-kerberos-configuration">
<span id="server-kerberos-configuration"></span><h3 id="mit-kerberos-configuration">MIT Kerberos Configuration<a class="headerlink" href="#mit-kerberos-configuration" title="Permalink to this headline">#</a></h3>
<p>Kerberos needs to be configured on the Presto coordinator. At a minimum, there needs
to be a <code class="docutils literal notranslate"><span class="pre">kdc</span></code> entry in the <code class="docutils literal notranslate"><span class="pre">[realms]</span></code> section of the <code class="docutils literal notranslate"><span class="pre">/etc/krb5.conf</span></code>
file. You may also want to include an <code class="docutils literal notranslate"><span class="pre">admin_server</span></code> entry and ensure that
the Presto coordinator can reach the Kerberos admin server on port 749.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[realms]
  PRESTO.EXAMPLE.COM = {
    kdc = kdc.example.com
    admin_server = kdc.example.com
  }

[domain_realm]
  .presto.example.com = PRESTO.EXAMPLE.COM
  presto.example.com = PRESTO.EXAMPLE.COM
</pre></div>
</div>
<p>The complete <a class="reference external" href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/conf_files/kdc_conf.html">documentation</a>
for <code class="docutils literal notranslate"><span class="pre">krb5.conf</span></code> is hosted by the MIT Kerberos Project. If you are using a
different implementation of the Kerberos protocol, you will need to adapt the
configuration to your environment.</p>
</section>
<section id="kerberos-principals-and-keytab-files">
<span id="server-kerberos-principals"></span><h3 id="kerberos-principals-and-keytab-files">Kerberos Principals and Keytab Files<a class="headerlink" href="#kerberos-principals-and-keytab-files" title="Permalink to this headline">#</a></h3>
<p>The Presto coordinator needs a Kerberos principal, as do users who are going to
connect to the Presto coordinator. You will need to create these users in
Kerberos using <a class="reference external" href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/admin_commands/kadmin_local.html">kadmin</a>.</p>
<p>In addition, the Presto coordinator needs a <a class="reference external" href="http://web.mit.edu/kerberos/krb5-devel/doc/basic/keytab_def.html">keytab file</a>. After you create the principal, you can create the keytab file using <strong class="command">kadmin</strong></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>kadmin
&gt; addprinc -randkey presto@EXAMPLE.COM
&gt; addprinc -randkey presto/presto-coordinator.example.com@EXAMPLE.COM
&gt; ktadd -k /etc/presto/presto.keytab presto@EXAMPLE.COM
&gt; ktadd -k /etc/presto/presto.keytab presto/presto-coordinator.example.com@EXAMPLE.COM
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Running <strong class="command">ktadd</strong> randomizes the principal’s keys. If you have just
created the principal, this does not matter. If the principal already exists,
and if existing users or services rely on being able to authenticate using a
password or a keytab, use the <code class="docutils literal notranslate"><span class="pre">-norandkey</span></code> option to <strong class="command">ktadd</strong>.</p>
</div>
</section>
<section id="java-cryptography-extension-policy-files">
<h3 id="java-cryptography-extension-policy-files">Java Cryptography Extension Policy Files<a class="headerlink" href="#java-cryptography-extension-policy-files" title="Permalink to this headline">#</a></h3>
<p>The Java Runtime Environment is shipped with policy files that limit the
strength of the cryptographic keys that can be used. Kerberos, by default, uses
keys that are larger than those supported by the included policy files. There
are two possible solutions to the problem:</p>
<blockquote>
<div><ul class="simple">
<li><p>Update the <abbr title="Java Cryptography Extension">JCE</abbr> policy files.</p></li>
<li><p>Configure Kerberos to use reduced-strength keys.</p></li>
</ul>
</div></blockquote>
<p>Of the two options, updating the JCE policy files is recommended. The JCE
policy files can be downloaded from Oracle. Note that the JCE policy files vary
based on the major version of Java you are running. Java 6 policy files will
not work with Java 8, for example.</p>
<p>The Java 8 policy files are available <a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html">here</a>.
Instructions for installing the policy files are included in a <code class="docutils literal notranslate"><span class="pre">README</span></code> file in
the ZIP archive. You will need administrative access to install the policy
files if you are installing them in a system JRE.</p>
</section>
<section id="java-keystore-file-for-tls">
<h3 id="java-keystore-file-for-tls">Java Keystore File for TLS<a class="headerlink" href="#java-keystore-file-for-tls" title="Permalink to this headline">#</a></h3>
<p>When using Kerberos authentication, access to the Presto coordinator should be
through HTTPS. You can do it by creating a <a class="reference internal" href="tls.html#server-java-keystore"><span class="std std-ref">Java Keystore File for TLS</span></a> on the
coordinator.</p>
</section>
</section>
<section id="system-access-control-plugin">
<h2 id="system-access-control-plugin">System Access Control Plugin<a class="headerlink" href="#system-access-control-plugin" title="Permalink to this headline">#</a></h2>
<p>A Presto coordinator with Kerberos enabled will probably need a
<a class="reference internal" href="../develop/system-access-control.html"><span class="doc">System Access Control</span></a> plugin to achieve
the desired level of security.</p>
</section>
<section id="presto-coordinator-node-configuration">
<h2 id="presto-coordinator-node-configuration">Presto Coordinator Node Configuration<a class="headerlink" href="#presto-coordinator-node-configuration" title="Permalink to this headline">#</a></h2>
<p>You must make the above changes to the environment prior to configuring the
Presto coordinator to use Kerberos authentication and HTTPS. After making the
following environment changes, you can make the changes to the Presto
configuration files.</p>
<ul class="simple">
<li><p><a class="reference internal" href="#server-kerberos-services"><span class="std std-ref">Kerberos Services</span></a></p></li>
<li><p><a class="reference internal" href="#server-kerberos-configuration"><span class="std std-ref">MIT Kerberos Configuration</span></a></p></li>
<li><p><a class="reference internal" href="#server-kerberos-principals"><span class="std std-ref">Kerberos Principals and Keytab Files</span></a></p></li>
<li><p><a class="reference internal" href="tls.html#server-java-keystore"><span class="std std-ref">Java Keystore File for TLS</span></a></p></li>
<li><p><a class="reference internal" href="../develop/system-access-control.html"><span class="doc">System Access Control Plugin</span></a></p></li>
</ul>
<section id="config-properties">
<h3 id="config-properties">config.properties<a class="headerlink" href="#config-properties" title="Permalink to this headline">#</a></h3>
<p>Kerberos authentication is configured in the coordinator node’s
<code class="file docutils literal notranslate"><span class="pre">config.properties</span></code> file. The entries that need to be added are listed below.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>http-server.authentication.type=KERBEROS

http.server.authentication.krb5.service-name=presto
http.server.authentication.krb5.service-hostname=presto.example.com
http.server.authentication.krb5.keytab=/etc/presto/presto.keytab
http.authentication.krb5.config=/etc/krb5.conf

http-server.https.enabled=true
http-server.https.port=7778

http-server.https.keystore.path=/etc/presto_keystore.jks
http-server.https.keystore.key=keystore_password
</pre></div>
</div>
<table>
<colgroup>
<col style="width: 50%"/>
<col style="width: 50%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">http-server.authentication.type</span></code></p></td>
<td><p>Authentication type for the Presto
coordinator. Must be set to <code class="docutils literal notranslate"><span class="pre">KERBEROS</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">http.server.authentication.krb5.service-name</span></code></p></td>
<td><p>The Kerberos service name for the Presto coordinator.
Must match the Kerberos principal.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">http.server.authentication.krb5.principal-hostname</span></code></p></td>
<td><p>The Kerberos hostname for the Presto coordinator.
Must match the Kerberos principal. This parameter is
optional. If included, Presto will use this value
in the host part of the Kerberos principal instead
of the machine’s hostname.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">http.server.authentication.krb5.keytab</span></code></p></td>
<td><p>The location of the keytab that can be used to
authenticate the Kerberos principal.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">http.authentication.krb5.config</span></code></p></td>
<td><p>The location of the Kerberos configuration file.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">http-server.https.enabled</span></code></p></td>
<td><p>Enables HTTPS access for the Presto coordinator.
Should be set to <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">http-server.https.port</span></code></p></td>
<td><p>HTTPS server port.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">http-server.https.keystore.path</span></code></p></td>
<td><p>The location of the Java Keystore file that will be
used to secure TLS.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">http-server.https.keystore.key</span></code></p></td>
<td><p>The password for the keystore. This must match the
password you specified when creating the keystore.</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Monitor CPU usage on the Presto coordinator after enabling HTTPS. Java
prefers the more CPU-intensive cipher suites if you allow it to choose from
a big list. If the CPU usage is unacceptably high after enabling HTTPS,
you can configure Java to use specific cipher suites by setting
the <code class="docutils literal notranslate"><span class="pre">http-server.https.included-cipher</span></code> property to only allow
cheap ciphers. Non forward secrecy (FS) ciphers are disabled by default.
As a result, if you want to choose non FS ciphers, you need to set the
<code class="docutils literal notranslate"><span class="pre">http-server.https.excluded-cipher</span></code> property to an empty list in order to
override the default exclusions.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>http-server.https.included-cipher=TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA256
http-server.https.excluded-cipher=
</pre></div>
</div>
<p>The Java documentation lists the <a class="reference external" href="http://docs.oracle.com/javase/8/docs/technotes/guides/security/SunProviders.html#SupportedCipherSuites">supported cipher suites</a>.</p>
</div>
</section>
<section id="access-controls-properties">
<h3 id="access-controls-properties">access-controls.properties<a class="headerlink" href="#access-controls-properties" title="Permalink to this headline">#</a></h3>
<p>At a minimum, an <code class="file docutils literal notranslate"><span class="pre">access-control.properties</span></code> file must contain an
<code class="docutils literal notranslate"><span class="pre">access-control.name</span></code> property.  All other configuration is specific
for the implementation being configured.
See <a class="reference internal" href="../develop/system-access-control.html"><span class="doc">System Access Control</span></a> for details.</p>
</section>
</section>
<section id="troubleshooting">
<span id="coordinator-troubleshooting"></span><h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">#</a></h2>
<p>Getting Kerberos authentication working can be challenging. You can
independently verify some of the configuration outside of Presto to help narrow
your focus when trying to solve a problem.</p>
<section id="kerberos-verification">
<h3 id="kerberos-verification">Kerberos Verification<a class="headerlink" href="#kerberos-verification" title="Permalink to this headline">#</a></h3>
<p>Ensure that you can connect to the KDC from the Presto coordinator using
<strong class="command">telnet</strong>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ telnet kdc.example.com 88
</pre></div>
</div>
<p>Verify that the keytab file can be used to successfully obtain a ticket using
<a class="reference external" href="http://web.mit.edu/kerberos/krb5-1.12/doc/user/user_commands/kinit.html">kinit</a> and
<a class="reference external" href="http://web.mit.edu/kerberos/krb5-1.12/doc/user/user_commands/klist.html">klist</a></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ kinit -kt /etc/presto/presto.keytab presto@EXAMPLE.COM
$ klist
</pre></div>
</div>
</section>
<section id="java-keystore-file-verification">
<h3 id="java-keystore-file-verification">Java Keystore File Verification<a class="headerlink" href="#java-keystore-file-verification" title="Permalink to this headline">#</a></h3>
<p>Verify the password for a keystore file and view its contents using
<a class="reference internal" href="tls.html#troubleshooting-keystore"><span class="std std-ref">Java Keystore File Verification</span></a></p>
</section>
<section id="additional-kerberos-debugging-information">
<h3 id="additional-kerberos-debugging-information">Additional Kerberos Debugging Information<a class="headerlink" href="#additional-kerberos-debugging-information" title="Permalink to this headline">#</a></h3>
<p>You can enable additional Kerberos debugging information for the Presto
coordinator process by adding the following lines to the Presto <code class="docutils literal notranslate"><span class="pre">jvm.config</span></code>
file</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>-Dsun.security.krb5.debug=true
-Dlog.enable-console=true
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">-Dsun.security.krb5.debug=true</span></code> enables Kerberos debugging output from the
JRE Kerberos libraries. The debugging output goes to <code class="docutils literal notranslate"><span class="pre">stdout</span></code>, which Presto
redirects to the logging system. <code class="docutils literal notranslate"><span class="pre">-Dlog.enable-console=true</span></code> enables output
to <code class="docutils literal notranslate"><span class="pre">stdout</span></code> to appear in the logs.</p>
<p>The amount and usefulness of the information the Kerberos debugging output
sends to the logs varies depending on where the authentication is failing.
Exception messages and stack traces can also provide useful clues about the
nature of the problem.</p>
</section>
<section id="additional-resources">
<span id="server-additional-resources"></span><h3 id="additional-resources">Additional resources<a class="headerlink" href="#additional-resources" title="Permalink to this headline">#</a></h3>
<p><a class="reference external" href="http://docs.oracle.com/cd/E19253-01/816-4557/trouble-6/index.html">Common Kerberos Error Messages (A-M)</a></p>
<p><a class="reference external" href="http://docs.oracle.com/cd/E19253-01/816-4557/trouble-27/index.html">Common Kerberos Error Messages (N-Z)</a></p>
<p><a class="reference external" href="http://web.mit.edu/kerberos/krb5-latest/doc/admin/troubleshoot.html">MIT Kerberos Documentation: Troubleshooting</a></p>
</section>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="../security.html" title="Security"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Security </span>
              </div>
            </a>
          
          
            <a href="cli.html" title="CLI Kerberos Authentication"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> CLI Kerberos Authentication </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright The Presto Foundation. All rights reserved. Presto is a registered trademark of LF Projects, LLC.
              
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>