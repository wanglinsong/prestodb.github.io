
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="../_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="../_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="../_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="374665">
  <script src="../_static/javascripts/modernizr.js"></script>
  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-82811140-44"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'UA-82811140-44');
</script>
  
  
    <title>Spill to Disk &#8212; Presto 0.280-SNAPSHOT Documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/material.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/presto.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Exchange Materialization" href="exchange-materialization.html" />
    <link rel="prev" title="Properties Reference" href="properties.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=grey data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#admin/spill" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../index.html" title="Presto 0.280-SNAPSHOT Documentation"
           class="md-header-nav__button md-logo">
          
              <img src="../_static/logo.png" height="26"
                   alt="Presto 0.280-SNAPSHOT Documentation logo">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">Presto 0.280-SNAPSHOT Documentation</span>
          <span class="md-header-nav__topic"> Spill to Disk </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="../search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder="Search"
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            <a href="https://github.com/prestodb/presto" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Presto
  </div>
</a>
          </div>
        </div>
      
      
  
  <script src="../_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = "../"versions.json"",
        target_loc = "../../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    <!-- empty -->
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../index.html" title="Presto 0.280-SNAPSHOT Documentation" class="md-nav__button md-logo">
      
        <img src="../_static/logo.png" alt=" logo" width="48" height="48">
      
    </a>
    <a href="../index.html"
       title="Presto 0.280-SNAPSHOT Documentation">Presto 0.280-SNAPSHOT Documentation</a>
  </label>
    <div class="md-nav__source">
      <a href="https://github.com/prestodb/presto" title="Go to repository" class="md-source" data-md-source="github">

    <div class="md-source__icon">
      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="28" height="28">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Presto
  </div>
</a>
    </div>
  
  

  
  <ul class="md-nav__list">
    <li class="md-nav__item">
    
    
      <a href="../overview.html" class="md-nav__link">Overview</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../installation.html" class="md-nav__link">Installation</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../security.html" class="md-nav__link">Security</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../admin.html" class="md-nav__link">Administration</a>
      <ul class="md-nav__list"> 
    <li class="md-nav__item">
    
    
      <a href="web-interface.html" class="md-nav__link">Web Interface</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="tuning.html" class="md-nav__link">Tuning Presto</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="properties.html" class="md-nav__link">Properties Reference</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    <label class="md-nav__link md-nav__link--active" for="__toc"> Spill to Disk </label>
    
      <a href="#" class="md-nav__link md-nav__link--active">Spill to Disk</a>
      
        
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#admin-spill--page-root" class="md-nav__link">Spill to Disk</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#overview" class="md-nav__link">Overview</a>
        </li>
        <li class="md-nav__item"><a href="#memory-management-and-spill" class="md-nav__link">Memory Management and Spill</a>
        </li>
        <li class="md-nav__item"><a href="#revocable-memory-and-reserved-pool" class="md-nav__link">Revocable memory and reserved pool</a>
        </li>
        <li class="md-nav__item"><a href="#spill-disk-space" class="md-nav__link">Spill Disk Space</a>
        </li>
        <li class="md-nav__item"><a href="#spill-compression" class="md-nav__link">Spill Compression</a>
        </li>
        <li class="md-nav__item"><a href="#spill-encryption" class="md-nav__link">Spill Encryption</a>
        </li>
        <li class="md-nav__item"><a href="#supported-operations" class="md-nav__link">Supported Operations</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#joins" class="md-nav__link">Joins</a>
        </li>
        <li class="md-nav__item"><a href="#aggregations" class="md-nav__link">Aggregations</a>
        </li>
        <li class="md-nav__item"><a href="#windows" class="md-nav__link">Windows</a>
        </li>
        <li class="md-nav__item"><a href="#order-bys" class="md-nav__link">Order Bys</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="exchange-materialization.html" class="md-nav__link">Exchange Materialization</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="resource-groups.html" class="md-nav__link">Resource Groups</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="session-property-managers.html" class="md-nav__link">Session Property Managers</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="function-namespace-managers.html" class="md-nav__link">Function Namespace Managers</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="dist-sort.html" class="md-nav__link">Distributed sort</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="verifier.html" class="md-nav__link">Presto Verifier</a>
      
    
    </li></ul>
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../cache.html" class="md-nav__link">Cache</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../optimizer.html" class="md-nav__link">Query Optimizer</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../connector.html" class="md-nav__link">Connectors</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../functions.html" class="md-nav__link">Functions and Operators</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../language.html" class="md-nav__link">SQL Language</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../sql.html" class="md-nav__link">SQL Statement Syntax</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../migration.html" class="md-nav__link">Migration</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../router.html" class="md-nav__link">Router</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../develop.html" class="md-nav__link">Developer Guide</a>
      
    
    </li>
    <li class="md-nav__item">
    
    
      <a href="../release.html" class="md-nav__link">Release Notes</a>
      
    
    </li>
  </ul>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">Contents</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#admin-spill--page-root" class="md-nav__link">Spill to Disk</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#overview" class="md-nav__link">Overview</a>
        </li>
        <li class="md-nav__item"><a href="#memory-management-and-spill" class="md-nav__link">Memory Management and Spill</a>
        </li>
        <li class="md-nav__item"><a href="#revocable-memory-and-reserved-pool" class="md-nav__link">Revocable memory and reserved pool</a>
        </li>
        <li class="md-nav__item"><a href="#spill-disk-space" class="md-nav__link">Spill Disk Space</a>
        </li>
        <li class="md-nav__item"><a href="#spill-compression" class="md-nav__link">Spill Compression</a>
        </li>
        <li class="md-nav__item"><a href="#spill-encryption" class="md-nav__link">Spill Encryption</a>
        </li>
        <li class="md-nav__item"><a href="#supported-operations" class="md-nav__link">Supported Operations</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#joins" class="md-nav__link">Joins</a>
        </li>
        <li class="md-nav__item"><a href="#aggregations" class="md-nav__link">Aggregations</a>
        </li>
        <li class="md-nav__item"><a href="#windows" class="md-nav__link">Windows</a>
        </li>
        <li class="md-nav__item"><a href="#order-bys" class="md-nav__link">Order Bys</a>
        </li></ul>
            </nav>
        </li></ul>
            </nav>
        </li>
  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="spill-to-disk">
<h1 id="admin-spill--page-root">Spill to Disk<a class="headerlink" href="#admin-spill--page-root" title="Permalink to this headline">#</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#overview" id="id1">Overview</a></p></li>
<li><p><a class="reference internal" href="#memory-management-and-spill" id="id2">Memory Management and Spill</a></p></li>
<li><p><a class="reference internal" href="#revocable-memory-and-reserved-pool" id="id3">Revocable memory and reserved pool</a></p></li>
<li><p><a class="reference internal" href="#spill-disk-space" id="id4">Spill Disk Space</a></p></li>
<li><p><a class="reference internal" href="#spill-compression" id="id5">Spill Compression</a></p></li>
<li><p><a class="reference internal" href="#spill-encryption" id="id6">Spill Encryption</a></p></li>
<li><p><a class="reference internal" href="#supported-operations" id="id7">Supported Operations</a></p></li>
</ul>
</div>
<section id="overview">
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permalink to this headline">#</a></h2>
<p>In the case of memory intensive operations, Presto allows offloading
intermediate operation results to disk. The goal of this mechanism is to
enable execution of queries that require amounts of memory exceeding per query
or per node limits.</p>
<p>The mechanism is similar to OS level page swapping. However, it is
implemented on the application level to address specific needs of Presto.</p>
<p>Properties related to spilling are described in <a class="reference internal" href="properties.html#tuning-spilling"><span class="std std-ref">Spilling Properties</span></a>.</p>
</section>
<section id="memory-management-and-spill">
<h2 id="memory-management-and-spill">Memory Management and Spill<a class="headerlink" href="#memory-management-and-spill" title="Permalink to this headline">#</a></h2>
<p>By default, Presto kills queries if the memory requested by the query execution
exceeds session properties <code class="docutils literal notranslate"><span class="pre">query_max_memory</span></code> or
<code class="docutils literal notranslate"><span class="pre">query_max_memory_per_node</span></code>. This mechanism ensures fairness in allocation
of memory to queries and prevents deadlock caused by memory allocation.
It is efficient when there are a lot of small queries in the cluster, but
leads to killing large queries that don’t stay within the limits.</p>
<p>To overcome this inefficiency, the concept of revocable memory was introduced. A
query can request memory that does not count toward the limits, but this memory
can be revoked by the memory manager at any time. When memory is revoked, the
query runner spills intermediate data from memory to disk and continues to
process it later.</p>
<p>In practice, when the cluster is idle, and all memory is available, a memory
intensive query may use all of the memory in the cluster. On the other hand,
when the cluster does not have much free memory, the same query may be forced to
use disk as storage for intermediate data. A query that is forced to spill to
disk may have a longer execution time by orders of magnitude than a query that
runs completely in memory.</p>
<p>In order to achieve more consistent query performance while still allowing larger
queries to take advantage of spill-to-disk, <code class="docutils literal notranslate"><span class="pre">experimental.query-limit-spill-enabled</span></code>
can be set to <code class="docutils literal notranslate"><span class="pre">true</span></code>. This property will trigger spilling for a query whenever its
memory usage exceeds the per-node total memory limit, even if the memory pool is not
full. See <a class="reference internal" href="properties.html#tuning-spilling"><span class="std std-ref">Spilling Properties</span></a> for more information.</p>
<p>Please note that enabling spill-to-disk does not guarantee execution of all
memory intensive queries. There are some memory-intensive operations that do
not support spilling yet. It is also still possible that the query runner will fail
to divide intermediate data into chunks small enough that every chunk fits into
memory, leading to <code class="docutils literal notranslate"><span class="pre">Out</span> <span class="pre">of</span> <span class="pre">memory</span></code> errors while loading the data from disk.</p>
</section>
<section id="revocable-memory-and-reserved-pool">
<h2 id="revocable-memory-and-reserved-pool">Revocable memory and reserved pool<a class="headerlink" href="#revocable-memory-and-reserved-pool" title="Permalink to this headline">#</a></h2>
<p>Both reserved memory pool and revocable memory are designed to cope with low memory conditions.
When user memory pool is exhausted then a single query will be promoted to a reserved pool.
In such case only that query is allowed to progress thus reducing cluster
concurrency. Revocable memory will try to prevent that by triggering spill.
Reserved pool is of <code class="docutils literal notranslate"><span class="pre">query.max-total-memory-per-node</span></code> size. If
<code class="docutils literal notranslate"><span class="pre">query.max-total-memory-per-node</span></code> is large compared to the total memory
available on the node, then the general memory pool may not have enough
memory to run larger queries. If spill is enabled, then this will cause
excessive spilling for queries that consume large amounts of memory per node.
These queries would finish much quicker if spill were disabled because they
would execute in the reserved pool. However, doing so could also significantly
reduce cluster concurrency. In such a situation we recommend disabling the
reserved memory pool via the <code class="docutils literal notranslate"><span class="pre">experimental.reserved-pool-enabled</span></code> config
property.</p>
</section>
<section id="spill-disk-space">
<h2 id="spill-disk-space">Spill Disk Space<a class="headerlink" href="#spill-disk-space" title="Permalink to this headline">#</a></h2>
<p>Spilling intermediate results to disk and retrieving them back is expensive
in terms of IO operations. Thus, queries that use spill likely become
throttled by disk. To increase query performance it is recommended to
provide multiple paths on separate local devices for spill (property
<code class="docutils literal notranslate"><span class="pre">spiller-spill-path</span></code> in <a class="reference internal" href="properties.html#tuning-spilling"><span class="std std-ref">Spilling Properties</span></a>).</p>
<p>The system drive should not be used for spilling, especially not to the drive where the JVM
is running and writing logs. Doing so may lead to cluster instability. Additionally,
it is recommended to monitor the disk saturation of the configured spill paths.</p>
<p>Presto treats spill paths as independent disks (see <a class="reference external" href="https://en.wikipedia.org/wiki/Non-RAID_drive_architectures#JBOD">JBOD</a>), so
there is no need to use RAID for spill.</p>
</section>
<section id="spill-compression">
<h2 id="spill-compression">Spill Compression<a class="headerlink" href="#spill-compression" title="Permalink to this headline">#</a></h2>
<p>When spill compression is enabled (<code class="docutils literal notranslate"><span class="pre">spill-compression-enabled</span></code> property in
<a class="reference internal" href="properties.html#tuning-spilling"><span class="std std-ref">Spilling Properties</span></a>), spilled pages will be compressed using the same
implementation as exchange compression when they are sufficiently compressible.
Enabling this feature can reduce the amount of disk IO at the cost
of extra CPU load to compress and decompress spilled pages.</p>
</section>
<section id="spill-encryption">
<h2 id="spill-encryption">Spill Encryption<a class="headerlink" href="#spill-encryption" title="Permalink to this headline">#</a></h2>
<p>When spill encryption is enabled (<code class="docutils literal notranslate"><span class="pre">spill-encryption-enabled</span></code> property in
<a class="reference internal" href="properties.html#tuning-spilling"><span class="std std-ref">Spilling Properties</span></a>), spill contents will be encrypted with a randomly generated
(per spill file) secret key. Enabling this will decrease the performance of spilling
to disk but can protect spilled data from being recovered from the files written to disk.</p>
<p><strong>Note</strong>: Some distributions of Java ship with policy files that limit the strength
of the cryptographic keys that can be used. Spill encryption uses
256-bit AES keys and may require Unlimited Strength <abbr title="Java Cryptography Extension">JCE</abbr>
policy files to work correctly.</p>
</section>
<section id="supported-operations">
<h2 id="supported-operations">Supported Operations<a class="headerlink" href="#supported-operations" title="Permalink to this headline">#</a></h2>
<p>Not all operations support spilling to disk, and each handles spilling
differently. Currently, the mechanism is implemented for the following
operations.</p>
<section id="joins">
<h3 id="joins">Joins<a class="headerlink" href="#joins" title="Permalink to this headline">#</a></h3>
<p>During the join operation, one of the tables being joined is stored in memory.
This table is called the build table. The rows from the other table stream
through and are passed onto the next operation if they match rows in the build
table. The most memory-intensive part of the join is this build table.</p>
<p>When the task concurrency is greater than one, the build table is partitioned.
The number of partitions is equal to the value of the <code class="docutils literal notranslate"><span class="pre">task.concurrency</span></code>
configuration parameter (see <a class="reference internal" href="properties.html#task-properties"><span class="std std-ref">Task Properties</span></a>).</p>
<p>When the build table is partitioned, the spill-to-disk mechanism can decrease
the peak memory usage needed by the join operation. When a query approaches the
memory limit, a subset of the partitions of the build table gets spilled to disk,
along with rows from the other table that fall into those same partitions. The
number of partitions that get spilled influences the amount of disk space needed.</p>
<p>Afterward, the spilled partitions are read back one-by-one to finish the join
operation.</p>
<p>With this mechanism, the peak memory used by the join operator can be decreased
to the size of the largest build table partition. Assuming no data skew, this will
be <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">/</span> <span class="pre">task.concurrency</span></code> times the size of the whole build table.</p>
</section>
<section id="aggregations">
<h3 id="aggregations">Aggregations<a class="headerlink" href="#aggregations" title="Permalink to this headline">#</a></h3>
<p>Aggregation functions perform an operation on a group of values and return one
value. If the number of groups you’re aggregating over is large, a significant
amount of memory may be needed. When spill-to-disk is enabled, if there is not
enough memory, intermediate cumulated aggregation results are written to disk.
They are loaded back and merged when memory is available.</p>
</section>
<section id="windows">
<h3 id="windows">Windows<a class="headerlink" href="#windows" title="Permalink to this headline">#</a></h3>
<p>Window functions perform an operation over groups of rows and return one value per-row.
If the number of rows in your window is large, a significant amount of memory may be needed.
When spill-to-disk is enabled, if there is not enough memory, then intermediate results
are written to disk and read back as each window is processed. If a single window is too
large, the query can still run out of memory.</p>
</section>
<section id="order-bys">
<h3 id="order-bys">Order Bys<a class="headerlink" href="#order-bys" title="Permalink to this headline">#</a></h3>
<p>Order by can use a lot of memory when there are many rows that need to be sorted.
When spill-to-disk is enabled, if there is not enough memory, then sorted rows are written
to disk and then later merged back together in memory.</p>
</section>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="properties.html" title="Properties Reference"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> Previous </span> Properties Reference </span>
              </div>
            </a>
          
          
            <a href="exchange-materialization.html" title="Exchange Materialization"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> Next </span> Exchange Materialization </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright The Presto Foundation. All rights reserved. Presto is a registered trademark of LF Projects, LLC.
              
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script src="../_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>